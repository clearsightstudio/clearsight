#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'clearsight.rb'

class App
  include Methadone::Main
  include Methadone::CLILogging
  include Methadone::SH

  # Create command line options here. Don't forget to document
  # them below in the show_help method.
  main do |command, *args|
    case command.to_s.to_sym
    when :deploy then Clearsight::Deploy.deploy(args)
    when :update then update
    when :help then show_help
    else
      puts "Invalid command."
      show_help
    end
  end

  def self.show_help
    puts "USAGE:"
    puts "  deploy <setup>"
    puts "    Deploys or sets up deployment to a remote server. Replaces gitdeploysetup."
    puts "  update"
    puts "    Updates the gem. Same as `gem update clearsight`."
  end

  def self.update
    print "Updating..."
    sh "gem update clearsight"
    puts "done."
  end

  arg :args, :optional
  
  version Clearsight::VERSION

  use_log_level_option

  go!
end
